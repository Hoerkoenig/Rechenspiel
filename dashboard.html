<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            color: white;
            padding: 20px;
        }
        .container {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        h2 {
            font-size: 28px;
        }
        p {
            font-size: 20px;
            margin: 10px 0;
        }
        button {
            font-size: 18px;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-play {
            background: #28a745;
            color: white;
        }
        .btn-play:hover {
            background: #218838;
        }
        .btn-logout {
            background: #dc3545;
            color: white;
        }
        .btn-logout:hover {
            background: #c82333;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>🏆 Willkommen im Spiel!</h2>
        <p id="user-name">👤 Name: </p>
        <p id="user-level">📈 Aktuelles Level: </p>
        <p id="last-visit">⏳ Letzter Besuch: </p>

        <button id="playButton" class="btn-play">🎮 Level starten</button>
        <br>
        <button class="btn-logout" onclick="logout()">🔴 Abmelden</button>
    </div>

    <!-- ✅ Firebase-Skripte -->
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>

    <script>
        // ✅ Firebase-Konfiguration
        const firebaseConfig = {
            apiKey: "DEIN_API_KEY",
            authDomain: "DEIN_AUTH_DOMAIN",
            projectId: "DEIN_PROJECT_ID",
            storageBucket: "DEIN_STORAGE_BUCKET",
            messagingSenderId: "DEIN_MESSAGING_ID",
            appId: "DEIN_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ✅ Auth-Status überwachen
   auth.onAuthStateChanged(user => {
    console.log("🔍 Auth-Status überprüft:", user);

    if (user === null) {
        console.log("⏳ Warten auf Firebase...");
        setTimeout(() => {
            location.reload(); // Noch mal laden, falls Firebase zu langsam war
        }, 5000);
        return;
    }

    if (!user) {
        console.log("🚫 Kein Benutzer erkannt. Weiterleitung zur Startseite...");
        setTimeout(() => {
            window.location.href = "index.html";
        }, 1000);
        return;
    }

    console.log("✅ Benutzer erfolgreich erkannt:", user.uid);
    loadUserData(user.uid);


});


        // ✅ Benutzer-Daten abrufen & zum richtigen Level weiterleiten
        function loadUserData(userId) {
            db.collection("users").doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    document.getElementById("user-name").textContent = "👤 Name: " + data.name;
                    document.getElementById("user-level").textContent = "📈 Aktuelles Level: " + data.level;
                    document.getElementById("last-visit").textContent = "⏳ Letzter Besuch: " + new Date(data.lastVisit).toLocaleString();

                    // Button mit sicherer Weiterleitung
                    const playButton = document.getElementById("playButton");
                    playButton.onclick = () => {
                        console.log("🎮 Starte Level:", data.level);
                        window.location.href = `level.html?level=${data.level}`;
                    };

                } else {
                    console.log("⚠️ Keine Benutzerdaten gefunden.");
                }
            })
            .catch(error => console.error("❌ Fehler beim Laden:", error));
        }

        // ✅ Abmelden
        function logout() {
            auth.signOut()
            .then(() => {
                console.log("🔴 Benutzer abgemeldet.");
                window.location.href = "index.html";
            })
            .catch(error => console.error("❌ Fehler beim Logout:", error));
        }
    </script>

</body>
</html>
